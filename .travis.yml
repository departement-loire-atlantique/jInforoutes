env:
  global:
  - secure: xJLi0DnuokYIn5pByElDcwAmIPRkHuy9Hs2JmjqHroYo6Bxhj+pSC4d2Yh3NW0/KL8bSVbZGzxwCZL3sYA7CYOuMWFqKljUPWIbvAN0lIGn9pQaFJgy/5WaF71MaIPHoIcI7l/0r1sS3QqOrmFcQjirGP8GilDfPEbuFMf1ugLan4XGi/GlftWH4HA4QDfqndGoY2SlHHW2FwpiW2gyqliStthdVZEbys1WJqBQjgjG0gOqIiIC2F7xpvNxb9FYKThbfKiTwppumWebe04+renTEcNvl6+u/9FC1WdG6c1uoXYyWaEl3Uo+hn6BSX+GDMw7bgMSLioQf6YmS2MzaA6LtdYAQvb3BoU9D1DRKQrZSnM4rzVbjRGSbNUSCrmfu+8AAAQxJXSnklOXY5eny189h3CE7aUOKR2o+DKnslVJ6AsOCFRN0id5ewYi7RGjgl00bVMW/WwTe9pnD4oGWCEJKd+JsAL1GKR95OW6z4Vp2PC+3/4jlHOhBHEY/ni8TEtPKRns8pulKtljsLWZCczYIO1nz+Qj2O468ykzsRZ81hyISFzCrj/xIpaaR4tLPet/LPoZW3JgaSBMBRDKDYwdy1cEXVJXUXyk3yCRfEwdIfCPWeLAmTZb8bcvWicKZxDmRcI/g+0e5NQ71Sq4SONiy3XhfiFgn3xBS9kaRv+Y=
  - secure: HmcloYXCPEy6t5NSLFkP4827/Kcd0xj5RBTq3i11yC4/3ELWa4aoYAn1zY6zLI4DZ8QzcolWZFlygmtkDz5QJiJ4PbXnEIiD6KCn2uWjWtNaI3tbKjzaogchSvNJPw9C3FhvbrpcGC4+3HLnOll4z1HPf0iMe0SwyPZ8PGeP7Nla57HZ6VbuNFfylHajFKgVVdifICyJom8ZDl/+z7kNO7kkZw5I+deDHIWZenMuy+VX4IqYVuRTNPvmau+j3Vhb2fBF2l7x4dZGLh25bHVEi0l11pXD0p57YjPIvKZS2FJTUq7p7yFab8aAyuWhnC6O38V51llkh7YoR1oKWd5O8m0a5Y5BkEzZpVS4wj8uA0M1QqU8AUrKky4nnGPEwojBXqR7i8nmEkKiQnONnUP2Me15SrH2qk+JmoQaXlBY8oBZeVtdCM6AcB4ylvO2gGJQv74YjVtjKw1aIw/tMp30M1aP3obJPMVWzVpwNOg7YfEPv6qc04Z3egnJ2vwGfwVhOQVfHRo8eSoGJdsqzcIFPb6SidMqn80O68foz0Uj1G1qE7wweMozMBrWGuydSEnYW9mjx3wfeKgl0c3M/zXol7cFua9UBJsP3gtefN8JKBNdYaBpN5fdzgTvci1cRxAawJwFBARsT+fo9M+Pxz3q8piYbMMN8MWds0PH7eYgapI=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: AVzaAelBGCKzK1IU4c1ailG3gt+Jmd88vBczyIkNbpyqkwdzBXXxMNmaSub/yPWJKzTQrFszbdyMYFtm1W5F497rTt1zSbYd5f3flL/us8krXVtrBrDdXsut/LWeu9HIszB0GyUPL5yEaP8NNo/hCqwOvLAya9DqQkmwYMIcD+piM4GdrQ3Q8/jxq/Dn5ov82SIuASECG2cGZhPLtFpEJ7Hv1O0KqcJhb9oEknkLt3ibb3p+n9n08uniETa1AWc/L+gU+SGNNqH/djvkOlLbax1wjIrTsaCdUYEg3k95JNvH3JXK4klC4igZPZFL9HkvcQ6E1xPt4XwjZ8DvXJPyD2Egv/jX7dqAQvNth5MH6KxJw9a83xi7OyhHobdr6fNLSosXrUpLsLz41Pr4Ppw1+EWjASCE1L0RYq0eNsPEB9CairEZD9hNUyURWijPyzdaPAPW+Bgt5w6+/Bs0l5YZFipHnKLl663i4yq71MktbEjA2BGVkocqfGMh24KRsR+WozRnx03HJTwYSlHk4qlvsDiXGYg/fpv0Wss1jRAnfVEnQcdc+z0nIW5CrVkfGfPvote3kw1Ia8SrOXxCJmgHeaCnBR4ljPZMfL71grX6mXWunesYlkT7ZPtkGOPCQ3l7+WhqsMM8+dpIw2BBtBouNrwyX/3EWqrzMB06mfprK3c=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull sguellec/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t sguellec/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: eIcc/TjdRej0bdt+bR0UbDxATzhg+eYE/1hzfE6wqkI/X03HMj0+pUlJRThFe3NvyMeN0yrNERXWlbWWgDgzohpgBiZRvjij7o5rM1dBXt7ERXJianI3ZLJ8HpAID778MDaepAGQBW/Jn46b11dJrZHyo4DfwhaRB9n5/K2YKxgFWciRMckbrOuGSIklAVIuUZ98NVMb2G5Ey3uAEW6gWBFuhw6IMfatH3fjR+HGSrehdecjstIeg9eg7Yg3fMCP71bsoE8tNUAAOmeeH5IXqCDGo1ikpWcTGQHfP08pE4OqrDbbKnVngRU6kcK5af78fuXSgQ4A6llD3tMGaXatc79sq++4BUaYTbHVRD1+rSmn0C3l94OhsOp5p2CEJxwixbBzt+NhKERM//AuA+fxe9/yPvNuN3PSWEmoiHHgpF34vyX+FLrwMnoM41p60F9HKPn+ct8RibC6P7JtAWtL6yZjxB82odLi/TdiGdbRkdw4I2wGmBeAeg78Gzs9epw153xsfd23qZZc1AZPdSHffGdZwyQm9f19qJik7VRSnurd9rnQDRfIcYlHzWLXOHfrjC6h61uxhGUVG817KMWHD7jKxPdJEWhtjt+IFw8/zUY1XY+1nd5fbGgE2aks8CskVa1Jrh0ZrJ3/+os+rfDj9E2hOCQbr1TiEUFsZo2zkUc=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
